# Modeling fugitive route-choice and police interception

Flow and files
- [prep_graph_Rotterdam.ipynb](prep_graph_Rotterdam.ipynb) import the graph from OpenStreetMap and the camera data from the data folder. The output of these files are the plotted graph and the saved graphs. 
- [enrich_graph_cool.ipynb](enrich_graph_cool.ipynb) and [enrich_graph_hot.ipynb](enrich_graph_hot.ipynb) import the relevant factors from OpenStreetMap and other data sources. These factors are used to create the graph attribute 'travel_time_adj' which reflects the attractiveness of a particular road segment. After, the best routes from the incident to each of the defined escape nodes are generated and saved. Lastly, the congestion factors are added, and intersections are divided in different categories, based on their characteristics (obstacles/distance between intersections/presence of a tram). 2 graphs are saved per mental mode (cool/hot): one with congestion ([graphs/Rotterdam_withtraffic_prepped_hot.graph.graphml](graphs/Rotterdam_withouttraffic_prepped_hot.graph.graphml)) and one without congestion ([graphs/Rotterdam_withouttraffic_prepped_hot.graph.graphml](graphs/Rotterdam_withouttraffic_prepped_hot.graph.graphml)). The travel time for police units is based on the travel time on a road and the possible occurence of congestion.
  It is important here that, due to a modelling choice, the differences between withtraffic and withouttraffic have to made manually. It occurs in 3 locations in the notebook, comments make this clear (search for '(change manually)'). 
- [run_model_cool.py](run_model_cool.py) and [run_model_hot.py](run_model_hot.py) import the `best' escape routes and pass them to a pyDSOL model, which adds a jitter factor to the routes. The output of these files are the resulting, final simulated escape routes. Congestion and traffic light delays are not taken into account (withouttraffic).
- [run_model_cool_mijnversie.py](run_model_cool.py) and [run_model_hot_mijnversie.py](run_model_hot.py) do the same as [run_model_cool.py](run_model_cool.py) and [run_model_hot.py](run_model_hot.py), but take congestion and delays at traffic lights into account (withtraffic).
- [optimize/optimize_positions.py](optimize/optimize_positions.py) import the resulting routes and optimizes the positions of the police units. The optimized positions and the resulting interception dictionary (reflecting which routes are intercepted by the chosen strategy) are saved. The police travel speed has to be changed between the different traffic conditions in two places, marked by '(change manually)'. Moreover, there is an option to switch the optimization run between withtraffic and withouttraffic, this occurs in 3 places and is also marked by '(change manually)'.
- In [optimize/cross_evaluation.py](optimize/cross_evaluation.py), these positions and the routes are imported to evaluate their relative robustness. I.e., how well do the optimized positions without taking traffic into account perform on the routes generated with traffic taken into account. The resulting heatmaps are saved in the [optimize/](optimize/) folder. 


**Important note**

To generate fugitive routes without traffic included, the files needed are [run_model_cool.py](run_model_cool.py) and [run_model_hot.py](run_model_hot.py). To generate fugitive routes with traffic included, the following files are needed: [run_model_cool_mijnversie.py](run_model_cool.py) and [run_model_hot_mijnversie.py](run_model_hot.py).
[optimize/optimize_positions.py](optimize/optimize_positions.py) and [optimize/cross_evaluation.py](optimize/cross_evaluation.py) take both situations into account.